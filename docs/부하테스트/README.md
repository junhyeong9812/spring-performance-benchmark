# 부하 테스트 용어 및 지표 가이드

k6 부하 테스트 결과를 이해하기 위한 용어 및 지표 설명서입니다.

---

## 📊 응답 시간 지표 (Response Time Metrics)

### 기본 통계

| 지표 | 설명 | 예시 |
|------|------|------|
| **avg** | 평균 응답 시간 | `avg=5.41ms` |
| **min** | 최소 응답 시간 | `min=959.85µs` |
| **med** | 중앙값 (50번째 백분위수) | `med=4.9ms` |
| **max** | 최대 응답 시간 | `max=54.13ms` |

### 백분위수 (Percentiles)

백분위수는 전체 요청 중 해당 비율의 요청이 특정 시간 이내에 완료됨을 의미합니다.

| 지표 | 설명 | 해석 |
|------|------|------|
| **p(50)** | 50%의 요청이 이 시간 이내 완료 | 중앙값과 동일 |
| **p(90)** | 90%의 요청이 이 시간 이내 완료 | 대부분의 사용자 경험 |
| **p(95)** | 95%의 요청이 이 시간 이내 완료 | **SLA 기준으로 자주 사용** |
| **p(99)** | 99%의 요청이 이 시간 이내 완료 | 극단적 케이스 제외 |

#### 예시 해석

```
p(95)=10.37ms
```
→ 전체 요청의 95%가 10.37ms 이내에 완료됨
→ 5%의 요청은 10.37ms보다 오래 걸림

#### 왜 p(95), p(99)가 중요한가?

- **avg(평균)**: 극단값에 영향받아 왜곡될 수 있음
- **p(95)**: 실제 사용자 경험을 더 정확히 반영
- **p(99)**: 최악의 케이스를 파악하는 데 유용

---

## 🔄 처리량 지표 (Throughput Metrics)

| 지표 | 설명 | 예시 |
|------|------|------|
| **http_reqs** | 총 HTTP 요청 수 | `79760` |
| **RPS (Requests Per Second)** | 초당 요청 처리 수 | `132.66/s` |
| **iterations** | 테스트 반복 횟수 | `19940` |
| **iteration_duration** | 1회 반복에 걸린 시간 | `avg=2.02s` |

### RPS 계산

```
RPS = 총 요청 수 / 테스트 시간(초)
예: 79760 / 601초 ≈ 132.66/s
```

---

## ❌ 에러 지표 (Error Metrics)

| 지표 | 설명 | 목표 |
|------|------|------|
| **http_req_failed** | HTTP 요청 실패율 | < 1% (0.01) |
| **errors** | 커스텀 에러율 | < 1% |

### 에러율 해석

```
http_req_failed: 0.00% 0 out of 79760
```
→ 79,760개 요청 중 0개 실패 (100% 성공)

---

## 👥 가상 사용자 지표 (Virtual Users)

| 지표 | 설명 |
|------|------|
| **VUs (Virtual Users)** | 동시 가상 사용자 수 |
| **vus** | 현재 활성 VU 수 |
| **vus_max** | 최대 VU 수 |

### VU vs 실제 사용자

- 1 VU = 1개의 동시 연결을 시뮬레이션
- 100 VUs ≠ 100명의 실제 사용자
- 실제 환경에서는 사용자가 페이지를 읽는 시간(think time)이 있음

---

## 📈 Threshold (임계값)

테스트 성공/실패를 판단하는 기준입니다.

### 기본 Threshold 예시

```javascript
thresholds: {
    http_req_duration: ['p(95)<500', 'p(99)<1000'],
    http_req_failed: ['rate<0.01'],
}
```

| 조건 | 의미 |
|------|------|
| `p(95)<500` | 95%의 요청이 500ms 미만이어야 통과 |
| `p(99)<1000` | 99%의 요청이 1000ms 미만이어야 통과 |
| `rate<0.01` | 에러율 1% 미만이어야 통과 |

### 결과 표시

```
█ THRESHOLDS 
  http_req_duration
  ✓ 'p(95)<500' p(95)=10.37ms    ← 통과
  ✗ 'p(95)<500' p(95)=623.45ms  ← 실패
```

---

## 🌐 네트워크 지표 (Network Metrics)

| 지표 | 설명 |
|------|------|
| **data_received** | 수신된 총 데이터량 |
| **data_sent** | 전송된 총 데이터량 |

### 예시

```
data_received: 224 MB  373 kB/s
data_sent:     6.9 MB  12 kB/s
```

---

## 💻 시스템 지표 (System Metrics - Grafana)

### CPU 관련

| 지표 | 설명 | 정상 범위 |
|------|------|----------|
| **System CPU Usage** | 전체 시스템 CPU 사용률 | < 80% |
| **Process CPU Usage** | 애플리케이션 프로세스 CPU | < 70% |
| **CPU Core Size** | 할당된 CPU 코어 수 | 설정값 |

### Load Average

| 지표 | 설명 | 해석 |
|------|------|------|
| **Load Average [1m]** | 1분간 평균 시스템 부하 | 코어 수 이하면 정상 |

#### Load Average 해석 (2코어 기준)

| 값 | 상태 |
|----|------|
| 0.5 | 여유 (25% 사용) |
| 1.0 | 적정 (50% 사용) |
| 2.0 | 최대 (100% 사용) |
| 3.0+ | 과부하 (대기열 발생) |

### GC (Garbage Collection)

| 지표 | 설명 | 좋은 값 |
|------|------|--------|
| **GC Count** | GC 발생 횟수 | 낮을수록 좋음 |
| **GC Stop the World Duration** | GC로 인한 애플리케이션 정지 시간 | < 10ms |

#### GC 유형

| 유형 | 설명 |
|------|------|
| **Minor GC** | Young Generation 영역 정리 (빠름) |
| **Major GC** | Old Generation 영역 정리 (느림) |
| **Full GC** | 전체 힙 정리 (가장 느림) |

---

## 📋 k6 테스트 시나리오 유형

### 1. Smoke Test

```
목적: 시스템이 정상 동작하는지 확인
VUs: 1~5
시간: 1분
```

### 2. Load Test

```
목적: 일반적인 부하에서 성능 측정
VUs: 50~100
시간: 10분+
패턴: 점진적 증가 → 유지 → 감소
```

### 3. Stress Test

```
목적: 시스템의 한계점 파악
VUs: 100~300+
시간: 10분+
패턴: 한계까지 점진적 증가
```

### 4. Spike Test

```
목적: 급격한 트래픽 변화 대응 확인
VUs: 10 ↔ 500
시간: 5분+
패턴: 급격한 증가/감소 반복
```

### 5. Soak Test (내구성 테스트)

```
목적: 장시간 운영 시 문제점 발견 (메모리 누수 등)
VUs: 일반 부하 수준
시간: 수 시간 ~ 수 일
```

---

## 📐 시간 단위

| 단위 | 풀네임 | 변환 |
|------|--------|------|
| **s** | second (초) | 1s = 1,000ms |
| **ms** | millisecond (밀리초) | 1ms = 1,000µs |
| **µs** | microsecond (마이크로초) | 1µs = 1,000ns |
| **ns** | nanosecond (나노초) | 최소 단위 |

### 예시

```
959.85µs = 0.96ms = 0.00096s
```

---

## 🎯 SLA/SLO 기준 예시

### 일반적인 웹 서비스 기준

| 등급 | p(95) 응답시간 | 에러율 |
|------|---------------|--------|
| 🟢 우수 | < 100ms | < 0.1% |
| 🟡 양호 | < 500ms | < 1% |
| 🟠 보통 | < 1000ms | < 5% |
| 🔴 미흡 | > 1000ms | > 5% |

### API 서비스 기준

| API 유형 | 목표 응답시간 |
|----------|--------------|
| 단순 조회 | < 50ms |
| DB 조회 | < 100ms |
| 복잡한 연산 | < 500ms |
| 외부 API 호출 | < 1000ms |

---

## 📚 참고 자료

- [k6 Documentation](https://k6.io/docs/)
- [k6 Metrics Reference](https://k6.io/docs/using-k6/metrics/)
- [k6 Thresholds](https://k6.io/docs/using-k6/thresholds/)
- [Understanding Percentiles](https://www.dynatrace.com/news/blog/why-averages-suck-and-percentiles-are-great/)